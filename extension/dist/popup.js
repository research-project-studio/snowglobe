(()=>{"use strict";!function(){const e=document.getElementById("no-map"),t=document.getElementById("map-found"),n=document.getElementById("recording"),s=document.getElementById("processing"),o=document.getElementById("error"),d=document.getElementById("map-info"),c=document.getElementById("open-devtools-btn"),a=document.getElementById("focus-devtools-btn"),r=document.getElementById("tile-count"),i=document.getElementById("request-count"),u=document.getElementById("data-size"),l=(document.getElementById("processing-message"),document.getElementById("progress-fill")),m=document.getElementById("progress-text"),g=document.getElementById("error-message"),p=document.getElementById("retry-btn");let y=null,E=null;function B(){e.classList.add("hidden"),t.classList.add("hidden"),n.classList.add("hidden"),s.classList.add("hidden"),o.classList.add("hidden")}function h(e){r.textContent=(e.tileCount||0).toString(),i.textContent=(e.totalRequests||0).toString(),u.textContent=function(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}(e.estimatedSize||0)}function I(e,t){B(),s.classList.remove("hidden"),l.style.width=`${e}%`,m.textContent=t}function f(){y&&(chrome.tabs.sendMessage(y,{type:"OPEN_DEVTOOLS_HINT"}),alert("DevTools will open. Look for the 'WebMap Archiver' panel tab.\n\nIf you don't see it, you may need to:\n1. Close and reopen DevTools\n2. Click the >> arrows to find more panels"))}function v(){E&&(clearInterval(E),E=null)}document.addEventListener("DOMContentLoaded",async function s(){const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!r?.id)return B(),o.classList.remove("hidden"),g.textContent="Cannot access current tab",void v();y=r.id;const i=await chrome.runtime.sendMessage({type:"GET_TAB_STATE",tabId:r.id});"recording"===i.capture?.status?(function(e){B(),n.classList.remove("hidden"),h(e)}(i.capture),v(),E=setInterval(async()=>{if(!y)return;const e=await chrome.runtime.sendMessage({type:"GET_TAB_STATE",tabId:y});"recording"===e.capture?.status?h(e.capture):"processing"===e.capture?.status?I(e.capture.progress||0,e.capture.message||"Processing..."):(v(),s())},500)):"processing"===i.capture?.status?I(i.capture.progress||0,i.capture.message||"Processing..."):i.maps?.count>0?function(e){B(),t.classList.remove("hidden");const n=e.types.join(", ");d.textContent=`${e.count} map${e.count>1?"s":""} detected (${n})`}(i.maps):(B(),e.classList.remove("hidden")),c.addEventListener("click",f),a?.addEventListener("click",f),p.addEventListener("click",s)}),window.addEventListener("unload",v)}()})();