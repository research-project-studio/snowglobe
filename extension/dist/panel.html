<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="panel.css">
</head>
<body>
  <div class="panel-container">
    <header>
      <h1>üó∫Ô∏è WebMap Archiver</h1>
      <span class="version">v0.3.2</span>
    </header>

    <!-- Idle State -->
    <div id="idle-state" class="state">
      <div class="status-card">
        <div class="status-icon">üìç</div>
        <div class="status-text">
          <h2>Ready to Capture</h2>
          <p id="map-status">Checking for maps...</p>
        </div>
      </div>

      <div class="instructions">
        <h3>How to capture:</h3>
        <ol>
          <li>Click <strong>Start Recording</strong> below</li>
          <li>Pan and zoom the map to load tiles for areas you want</li>
          <li>Visit different zoom levels to capture detail</li>
          <li>Click <strong>Stop & Archive</strong> when done</li>
        </ol>
      </div>

      <!-- Capture Options Panel -->
      <div id="options-panel" class="options-panel">
        <div class="options-header" id="options-header">
          <span class="options-toggle">‚ñ∂</span>
          <span>Capture Options</span>
        </div>
        <div id="options-content" class="options-content collapsed">
          <label class="option-item">
            <input type="checkbox" id="opt-reload-page" checked>
            <span>Reload page on capture start</span>
            <span class="option-hint">Ensures sprites and fonts are captured</span>
          </label>

          <label class="option-item">
            <input type="checkbox" id="opt-expand-coverage" checked>
            <span>Expand tile coverage</span>
            <span class="option-hint">Fetch additional zoom levels beyond captured area</span>
          </label>

          <label class="option-item">
            <span>Archive mode:</span>
            <select id="opt-archive-mode">
              <option value="standalone" selected>Standalone (viewer only)</option>
              <option value="original">Original (preserve site files)</option>
              <option value="full">Full (viewer + site files)</option>
            </select>
          </label>
        </div>
      </div>

      <div class="button-group">
        <button id="start-btn" class="primary-btn">
          ‚ñ∂Ô∏è Start Recording
        </button>
        <button id="test-debugger-btn" class="secondary-btn" style="margin-top: 8px;">
          üî¨ Test Debugger API
        </button>
      </div>
    </div>

    <!-- Recording State -->
    <div id="recording-state" class="state hidden">
      <div class="status-card recording">
        <div class="status-icon pulse">üî¥</div>
        <div class="status-text">
          <h2>Recording...</h2>
          <p id="recording-duration">0:00</p>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="stat-tiles">0</div>
          <div class="stat-label">Tiles Captured</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-requests">0</div>
          <div class="stat-label">Total Requests</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-size">0 B</div>
          <div class="stat-label">Data Size</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-zooms">-</div>
          <div class="stat-label">Zoom Levels</div>
        </div>
      </div>

      <div class="recent-tiles">
        <h3>Recent Tiles</h3>
        <div id="tile-list" class="tile-list">
          <p class="empty-message">Pan or zoom the map to capture tiles...</p>
        </div>
      </div>

      <div class="button-group">
        <button id="stop-btn" class="primary-btn">
          ‚èπÔ∏è Stop & Archive
        </button>
        <button id="cancel-btn" class="secondary-btn">
          Cancel
        </button>
      </div>
    </div>

    <!-- Processing State -->
    <div id="processing-state" class="state hidden">
      <div class="status-card">
        <div class="status-icon spin">‚è≥</div>
        <div class="status-text">
          <h2 id="processing-title">Processing...</h2>
          <p id="processing-message">Building capture bundle...</p>
        </div>
      </div>

      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-label" id="progress-label">0%</div>
      </div>
    </div>

    <!-- Complete State -->
    <div id="complete-state" class="state hidden">
      <div class="status-card success">
        <div class="status-icon">‚úÖ</div>
        <div class="status-text">
          <h2>Archive Complete!</h2>
          <p id="complete-filename">archive.zip</p>
        </div>
      </div>

      <div class="stats-summary">
        <p id="complete-stats">0 tiles ‚Ä¢ 0 B</p>
      </div>

      <div class="button-group">
        <button id="download-btn" class="primary-btn">
          ‚¨áÔ∏è Download Archive
        </button>
        <button id="download-bundle-btn" class="secondary-btn">
          üì¶ Download Raw Bundle
        </button>
        <button id="new-capture-btn" class="secondary-btn">
          üîÑ New Capture
        </button>
      </div>
    </div>

    <!-- Error State -->
    <div id="error-state" class="state hidden">
      <div class="status-card error">
        <div class="status-icon">‚ùå</div>
        <div class="status-text">
          <h2>Error</h2>
          <p id="error-message">Something went wrong.</p>
        </div>
      </div>

      <div class="button-group">
        <button id="retry-btn" class="primary-btn">
          üîÑ Try Again
        </button>
      </div>
    </div>

    <footer>
      <a href="https://github.com/research-project-studio/snowglobe" target="_blank">Documentation</a>
    </footer>
  </div>

  <script src="panel.js"></script>
</body>
</html>
